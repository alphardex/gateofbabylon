title: H5 开发小结
author: alphardex
abbrlink: 50603
tags:
  - Summary
categories:
  - 前端
date: 2020-08-10 16:55:00
---
# 前言

本文是我开发了许多 H5 活动后写下的小结

<!--more-->

# 正文

## 必备库

CSS：[aqua.css](https://github.com/alphardex/aqua.css)

JS：[kyouka](https://github.com/alphardex/kyouka)

## 样式

### 端口适配

移动端：`vw`

pc端：`px`

目前我适配两端的做法：将颜色等外观相关的属性放在一起，用媒体查询来隔开长度单位属性

### 防花屏

开启`gpu`加速

```css
transform: rotateZ(0);
```

### 加载速度慢

考虑压缩图片素材，[squoosh](https://squoosh.app/)和[腾讯智图](https://zhitu.isux.us/index.php/preview/download)皆可

### 自定义字体

用[fontmin](https://github.com/ecomfe/fontmin)生成字体再插入页面即可

## 业务

### ios 键盘弹出错位修复

```js
ky.iosInputScrollFix();
```

### 禁止滚动

```js
ky.disableTouchMove();
```

### 防止提交后再次发送请求

动态绑定一个`pointer-events-none`类即可

### 弹窗点击空白处可关闭

分 2 种情况：

1. 一般弹窗，用[sweetalert2](https://github.com/sweetalert2/sweetalert2)
2. 自定义弹窗，用`useDialog`钩子

### 判断用户是否已划到底部

```js
ky.isBottomVisible();
```

### 禁止点击元素的同时弹出提示弹窗

新增一个透明元素覆盖在原先的元素上，在上面触发点击事件弹出弹窗即可

### 安卓机兼容无限下拉加载

- 不能在底部放绝对定位的图片，否则会影响高度计算，正确的做法是在加载完成后再显示图片
- 注意安卓有虚拟键会导致划不到底，应该给触底条件添加一个容差

### 强制刷新缓存

有的手机缓存不容易清除，此时就可以在文件后加后缀以清除缓存，例如`app.js?v=1`

### vue 项目将资源转移至 cdn

在`.env.production`中配置cdn地址即可

注：像app.xxx.css这类要经常改动的文件不放在cdn上

### vue 防止多个页面无限加载同时发请求

切换到另一个页面后，别忘了移除上一个页面的scroll监听

```js
onUnmounted(() => {
  window.removeEventListener("scroll", onReachBottom);
});
```

### Date 最兼容的写法

```js
new Date("2020/12/19 00:00:00")
```

## 注意点

1. 发送请求后注意要同步更新页面上的数据
2. 若用户上传的图片太大，则用[Compressor](https://github.com/fengyuanchen/compressorjs)压缩图片后再上传
3. 展示型页面一定要注意文本的长度，单行过长则应截断（`.truncate`），行数过多则做成滚动式（`.overflow-scroll`）
4. 图片很多的列表页应采用懒加载（[lazyload](https://github.com/tuupola/lazyload)）
5. 注意各个手机的适配，写完样式后在开发者工具里把每个手机都跑一遍，跑通后再真机测试
6. 如果后端还没有完成接口，那么前端可以先用假数据进行模拟测试（mock）
